<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dark Green Trip Planner</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1a2e05; }
    ::-webkit-scrollbar-thumb { background: #4ade80; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #22c55e; }
    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .trip-card { animation: fadeIn 0.4s ease-out forwards; }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <header class="mb-10 text-center">
      <h1 class="text-4xl font-bold text-emerald-400 mb-2">
        <i class="fas fa-map-marked-alt mr-2"></i> Travolt
      </h1>
      <p class="text-gray-400">Plan your adventures â€” Create, Edit & Manage Trips</p>
    </header>
    
    <!-- Create/Edit Trip Form -->
    <div class="bg-gray-800 rounded-xl shadow-2xl p-6 mb-10 border border-emerald-900/50">
      <h2 id="form-title" class="text-2xl font-semibold text-emerald-400 mb-6 flex items-center">
        <i class="fas fa-plus-circle mr-3"></i> Create New Trip
      </h2>
      <form id="create-trip" class="space-y-5">
        <input type="hidden" id="trip_id" />
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <div>
            <label for="destination" class="block text-sm font-medium text-emerald-300 mb-1">
              <i class="fas fa-map-marker-alt mr-2"></i> Destination
            </label>
            <input type="text" id="destination" placeholder="Where are you going?" required
              class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition duration-200"/>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="start_date" class="block text-sm font-medium text-emerald-300 mb-1">
                <i class="far fa-calendar-alt mr-2"></i> Start Date
              </label>
              <input type="date" id="start_date" required
                class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition duration-200"/>
            </div>
            <div>
              <label for="end_date" class="block text-sm font-medium text-emerald-300 mb-1">
                <i class="far fa-calendar-alt mr-2"></i> End Date
              </label>
              <input type="date" id="end_date" required
                class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition duration-200"/>
            </div>
          </div>
        </div>
        <div>
          <label for="budget" class="block text-sm font-medium text-emerald-300 mb-1">
            <i class="fas fa-wallet mr-2"></i> Budget ($)
          </label>
          <input type="number" id="budget" placeholder="Estimated trip budget" required
            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition duration-200"/>
        </div>
        <div>
          <label for="description" class="block text-sm font-medium text-emerald-300 mb-1">
            <i class="fas fa-align-left mr-2"></i> Description
          </label>
          <textarea id="description" placeholder="Tell us about your trip plans..." rows="4"
            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition duration-200"></textarea>
        </div>
        <div class="flex space-x-4">
          <button type="submit"
            class="flex-1 bg-gradient-to-r from-emerald-600 to-emerald-800 hover:from-emerald-500 hover:to-emerald-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition duration-200 transform hover:scale-[1.02] flex items-center justify-center">
            <i class="fas fa-paper-plane mr-2"></i> <span id="submit-text">Create Trip</span>
          </button>
          <button type="button" id="cancel-edit" class="hidden flex-1 bg-red-700 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition duration-200">
            Cancel Edit
          </button>
        </div>
      </form>
    </div>

    <!-- Saved Trips -->
    <div id="trips-list" class="space-y-5">
      <h2 class="text-2xl font-semibold text-emerald-400 mb-6 flex items-center">
        <i class="fas fa-suitcase-rolling mr-3"></i> Your Trips
      </h2>
    </div>
  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAeTT1M5kveFh6Jkeh7YcKbbe01qCLX5pI",
      authDomain: "travel-buddy-41464.firebaseapp.com",
      projectId: "travel-buddy-41464",
      storageBucket: "travel-buddy-41464.appspot.com",
      messagingSenderId: "236483299906",
      appId: "1:236483299906:web:81ea611253f7ad1361bbdb",
      measurementId: "G-PRQM52VGCV"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('create-trip');
      const tripsList = document.getElementById('trips-list');
      const tripIdField = document.getElementById('trip_id');
      const formTitle = document.getElementById('form-title');
      const submitText = document.getElementById('submit-text');
      const cancelBtn = document.getElementById('cancel-edit');

      loadTrips();

      // Submit handler
      form.addEventListener('submit', e => {
        e.preventDefault();

        const trip = {
          destination: form.destination.value,
          startDate: form.start_date.value,
          endDate: form.end_date.value,
          budget: Number(form.budget.value),
          description: form.description.value
        };

        const id = tripIdField.value;

        if (id) {
          // UPDATE existing
          db.collection('trips').doc(id).update(trip).then(() => {
            showNotification('Trip updated!', 'success');
            resetForm();
            loadTrips();
          });
        } else {
          // CREATE new
          db.collection('trips').add(trip).then(() => {
            showNotification('Trip added successfully!', 'success');
            form.reset();
            loadTrips();
          });
        }
      });

      // Cancel edit
      cancelBtn.addEventListener('click', resetForm);

      // Load fresh trips list
      function loadTrips() {
        tripsList.innerHTML = `<h2 class="text-2xl font-semibold text-emerald-400 mb-6 flex items-center">
          <i class="fas fa-suitcase-rolling mr-3"></i> Your Trips</h2>`;
        db.collection('trips').get().then(snapshot => {
          snapshot.forEach(doc => {
            const trip = doc.data();
            trip.id = doc.id;
            addTripToUI(trip);
          });
        });
      }

      // Render a trip card
      function addTripToUI(trip) {
        const card = document.createElement('div');
        card.className = 'trip-card bg-gray-800 rounded-xl p-5 border-l-4 border-emerald-500 shadow-lg';
        card.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <h3 class="text-xl font-bold text-emerald-400">${trip.destination}</h3>
              <p class="text-gray-400 text-sm mt-1"><i class="far fa-calendar-alt mr-1"></i> ${formatDate(trip.startDate)} - ${formatDate(trip.endDate)}</p>
            </div>
            <span class="bg-emerald-900/50 text-emerald-300 px-3 py-1 rounded-full text-sm">$${trip.budget}</span>
          </div>
          ${trip.description ? `<p class="mt-3 text-gray-300">${trip.description}</p>` : ''}
          <div class="mt-4 flex justify-end space-x-3">
            <button class="text-emerald-400 hover:text-emerald-300 edit-btn" data-id="${trip.id}"><i class="fas fa-edit"></i></button>
            <button class="text-red-400 hover:text-red-300 delete-btn" data-id="${trip.id}"><i class="fas fa-trash-alt"></i></button>
          </div>
        `;
        tripsList.appendChild(card);

        // Events
        card.querySelector('.delete-btn').addEventListener('click', () => deleteTrip(trip.id));
        card.querySelector('.edit-btn').addEventListener('click', () => editTrip(trip.id));
      }

      // Delete trip
      function deleteTrip(id) {
        db.collection('trips').doc(id).delete().then(() => {
          showNotification('Trip deleted!', 'success');
          loadTrips();
        });
      }

      // Edit trip (populate form)
      function editTrip(id) {
        db.collection('trips').doc(id).get().then(doc => {
          if (doc.exists) {
            const t = doc.data();
            tripIdField.value = id;
            form.destination.value = t.destination;
            form.start_date.value = t.startDate;
            form.end_date.value = t.endDate;
            form.budget.value = t.budget;
            form.description.value = t.description || '';
            formTitle.innerHTML = `<i class="fas fa-edit mr-3"></i> Edit Trip`;
            submitText.textContent = "Update Trip";
            cancelBtn.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        });
      }

      // Reset form to create mode
      function resetForm() {
        tripIdField.value = '';
        form.reset();
        formTitle.innerHTML = `<i class="fas fa-plus-circle mr-3"></i> Create New Trip`;
        submitText.textContent = "Create Trip";
        cancelBtn.classList.add('hidden');
      }

      // Format date nicely
      function formatDate(dateStr) {
        return new Date(dateStr).toLocaleDateString(undefined, {year:'numeric', month:'short', day:'numeric'});
      }

      // Show notification
      function showNotification(msg, type) {
        const box = document.createElement('div');
        box.className = `fixed bottom-5 right-5 px-6 py-3 rounded-lg shadow-lg 
          ${type==='success' ? 'bg-emerald-800 text-emerald-100' : 'bg-red-800 text-red-100'}`;
        box.innerHTML = `<i class="fas ${type==='success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i> ${msg}`;
        document.body.appendChild(box);
        setTimeout(() => { box.style.opacity = '0'; setTimeout(() => box.remove(), 300); }, 3000);
      }
    });
  </script>
</body>
</html>
